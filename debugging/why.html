<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Document</title>
    <style>
        *{
            padding: 0;
            margin: 0;
        }
        canvas{
            display: block;
            margin: 100px auto
        }
        #text{
            width: 300px;
            height: 40px;
            display: block;
            margin: 0 auto;
            padding: 0 10px;
            border: 1px solid #d8d8d8;
        }
        #btn{
            background-color: #0ba6ff;
            color: #fff;
            width: 120px;
            height: 40px;
            display: block;
            margin: 0 auto;
            color: #fff;
            outline: none;
            border: none;
            font-size: 14px;
            text-align: center;
            margin-top: 50px;
            border: 8px;
            margin-bottom: 50px;
        }
    </style>
</head>
<body>
    <canvas id="mainCanvas"></canvas>
    <input id="text" type="text" value="吔屎啦你？">
    <button id="btn">生成图片</button>
</body>
<script>
    var pr = 3
    var bgImage = new Image()
    bgImage.src = 'img/bg.png'
    var canvas = document.querySelector('#mainCanvas'),
        text = document.querySelector('#text'),
        btn = document.querySelector('#btn')
    var ctx = canvas.getContext('2d')
    bgImage.onload = function(){
        canvas.width = this.width / 2
        canvas.height = this.height / 2 
        canvas.style.width = this.width / pr + 'px'
        canvas.style.height = this.height / pr + 'px'

        draw(text.value)
    }
    function draw(_text){
        ctx.drawImage(bgImage, 0, 0, canvas.width, canvas.height)
        ctx.font = "60px blod Arial";
        ctx.fontWeight = 'blod'
        ctx.fillStyle = "#fff";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(_text, canvas.width/2, canvas.height - 50);
    }
    text.onkeyup = function(){
        draw(text.value)
    }
    btn.onclick = function(){

        var src = canvas.toDataURL("image/jpeg");
        console.log(src)



        if(isWeiXin()){
            var img = new Image()
            img.src = src
            wx.previewImage({
                current: src , // 当前显示图片的http链接
                urls: [src] // 需要预览的图片http链接列表
            })


        }else{
            var a = document.createElement('a')
            a.href = src
            a.setAttribute('download', 'chart-download')
            a.click()
        }
    }

    //判断是否是微信浏览器的函数
    function isWeiXin(){
        //window.navigator.userAgent属性包含了浏览器类型、版本、操作系统类型、浏览器引擎类型等信息，这个属性可以用来判断浏览器类型
        var ua = window.navigator.userAgent.toLowerCase();
        //通过正则表达式匹配ua中是否含有MicroMessenger字符串
        if(ua.match(/MicroMessenger/i) == 'micromessenger'){
            return true;
        }else{
            return false;
        }
    }


    
</script>
</html>